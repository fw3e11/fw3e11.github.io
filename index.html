<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="程序员的自我修养">
<meta property="og:url" content="http://thedatasolutions.com/index.html">
<meta property="og:site_name" content="程序员的自我修养">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="程序员的自我修养">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://thedatasolutions.com/"/>





  <title> 程序员的自我修养 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">程序员的自我修养</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://thedatasolutions.com/2017/09/20/TensorFlow-Study-Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="逢哥">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员的自我修养">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/20/TensorFlow-Study-Notes/" itemprop="url">
                  TensorFlow Study Notes
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-20T13:22:44+08:00">
                2017-09-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在国内安装TensorFlow，推荐使用中科大的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip3 install tensorflow -i https://mirrors.ustc.edu.cn/pypi/web/simple</div></pre></td></tr></table></figure>
<h2 id="Basic-Concept"><a href="#Basic-Concept" class="headerlink" title="Basic Concept"></a>Basic Concept</h2><p>首先是几个概念：什么是Tensor，什么是Flow？<br>数据（Data）是怎么表示的？数据是如何处理（manipulate）的？</p>
<h3 id="Tensors"><a href="#Tensors" class="headerlink" title="Tensors"></a>Tensors</h3><blockquote>
<p>the central unit of data in TensorFlow</p>
</blockquote>
<p><code>Tensor</code>就是数据，所以<code>TensorFlow</code>就是数据流转，通过数据的流转完成计算任务。是什么让数据流转起来？是<strong>图</strong>。</p>
<h3 id="The-Computational-Graph"><a href="#The-Computational-Graph" class="headerlink" title="The Computational Graph"></a>The Computational Graph</h3><blockquote>
<p>You might think of TensorFlow Core programs as consisting of two discrete sections:</p>
<ol>
<li>Building the computational graph</li>
<li>Running the computational graph</li>
</ol>
</blockquote>
<p><code>TensorFlow</code>可以理解为一个框架，让<code>Tensor</code>“<em>Flow</em>”起来就是</p>
<ol>
<li>构建一个“可计算的图”</li>
<li>运行这个图</li>
</ol>
<p>一切“运行”（<code>run</code>）的操作，必须在一个<code>Session</code>里面完成，<code>Session</code>包含了<code>TensorFlow</code>运行环境和执行上下文。</p>
<blockquote>
<p>A computational graph is a series of TensorFlow operations arranged into a graph of nodes.</p>
</blockquote>
<p>我们可以看出，<code>Tensor</code>和<code>Node</code>和<code>Data</code>是基本等效的同一个概念。</p>
<p>那么什么是<code>Operation</code>？就是<strong>操作</strong>。 我们从一个简单的例子入手：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python3</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line"></div><div class="line"><span class="comment"># Constants are initialized when you call tf.constant,</span></div><div class="line"><span class="comment"># and their value can never change.</span></div><div class="line">node1 = tf.constant(<span class="number">3</span>)  <span class="comment"># Tensor("Const:0", shape=(), dtype=int32)</span></div><div class="line">node2 = tf.constant(<span class="number">4.0</span>)  <span class="comment"># Tensor("Const_1:0", shape=(), dtype=float32)</span></div><div class="line"></div><div class="line">print(node1)</div><div class="line">print(node2)</div><div class="line"></div><div class="line"><span class="comment"># Model parameters</span></div><div class="line"><span class="comment"># Variables are not initialized when you call tf.Variable.</span></div><div class="line">W = tf.Variable([<span class="number">.3</span>], dtype=tf.float32)</div><div class="line">b = tf.Variable([<span class="number">-.3</span>], dtype=tf.float32)   </div><div class="line"></div><div class="line"><span class="comment"># Model input and output</span></div><div class="line">x = tf.placeholder(tf.float32)</div><div class="line">linear_model = W * x + b</div><div class="line"></div><div class="line"><span class="comment"># Loss</span></div><div class="line">y = tf.placeholder(tf.float32)</div><div class="line">loss = tf.reduce_sum(tf.square(linear_model - y))</div><div class="line"></div><div class="line"><span class="comment"># Optimizer</span></div><div class="line">optimizer = tf.train.GradientDescentOptimizer(<span class="number">0.01</span>)</div><div class="line">train = optimizer.minimize(loss)</div><div class="line"></div><div class="line"><span class="comment"># Training data</span></div><div class="line">x_train = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</div><div class="line">y_train = [<span class="number">0</span>, <span class="number">-1</span>, <span class="number">-2</span>, <span class="number">-3</span>]</div><div class="line"></div><div class="line">init = tf.global_variables_initializer() <span class="comment"># initial all variables</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> session:</div><div class="line">        print(session.run([node1, node2]))  <span class="comment"># [3, 4.0]</span></div><div class="line"></div><div class="line">        session.run(init)</div><div class="line">        print(session.run(loss, &#123;x: x_train, y: y_train&#125;))  <span class="comment"># 23.66</span></div><div class="line"></div><div class="line">        fixW = tf.assign(W, [<span class="number">-1.</span>])</div><div class="line">        fixb = tf.assign(b, [<span class="number">1.</span>])</div><div class="line">        session.run([fixW, fixb])  <span class="comment"># fixW, fixb are operations</span></div><div class="line">        print(session.run(loss, &#123;x: x_train, y: y_train&#125;))  <span class="comment"># 0.0</span></div><div class="line"></div><div class="line">        session.run(init)  <span class="comment"># reset variables</span></div><div class="line"></div><div class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">1000</span>):</div><div class="line">            session.run(train, &#123;x: x_train, y: y_train&#125;)</div><div class="line"></div><div class="line">        print(session.run([W, b, loss], &#123;x: x_train, y: y_train&#125;))</div><div class="line">        <span class="comment"># [array([-0.9999969], dtype=float32), array([ 0.99999082], dtype=float32), 5.6999738e-11]</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<h2 id="tf-estimator"><a href="#tf-estimator" class="headerlink" title="tf.estimator"></a>tf.estimator</h2><blockquote>
<p><code>tf.estimator</code> is a high-level TensorFlow library that simplifies the mechanics of machine learning:</p>
<ul>
<li>running the train loops</li>
<li>running the evaluation loops</li>
<li>managing data sets</li>
</ul>
</blockquote>
<p><code>tf.estimator</code> 提供了相当丰富的模型，同时支持底层API构建出自定义的模型。具体代码请看<a href="https://www.tensorflow.org/get_started/get_started" target="_blank" rel="external">官网</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://thedatasolutions.com/2017/07/25/LittleProxy-Study-Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="逢哥">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员的自我修养">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/25/LittleProxy-Study-Notes/" itemprop="url">
                  LittleProxy Study Notes
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-25T17:33:17+08:00">
                2017-07-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>LittleProxy is a high performance HTTP proxy written in Java atop Trustin Lee’s excellent <a href="http://netty.io" target="_blank" rel="external">Netty</a> event-based networking library. It’s quite stable, performs well, and is easy to integrate into your projects.</p>
</blockquote>
<h2 id="Hello-World-Like-Tutorial"><a href="#Hello-World-Like-Tutorial" class="headerlink" title="Hello-World-Like Tutorial"></a>Hello-World-Like Tutorial</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">HttpProxyServer server = DefaultHttpProxyServer.bootstrap()</div><div class="line">    .withPort(<span class="number">8080</span>)</div><div class="line">    .start();</div></pre></td></tr></table></figure>
<h2 id="More-Complicated"><a href="#More-Complicated" class="headerlink" title="More Complicated"></a>More Complicated</h2><p>源码结构解析：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * DefaultHttpProxyServer.java</span></div><div class="line"><span class="comment"> * class DefaultHttpProxyServer implements HttpProxyServer</span></div><div class="line"><span class="comment"> * Primary implementation of an &#123;@link HttpProxyServer&#125;.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpProxyServerBootstrap <span class="title">bootstrap</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * HttpProxyServerBootstrap.java</span></div><div class="line"><span class="comment"> * interface HttpProxyServerBootstrap</span></div><div class="line"><span class="comment"> * Configures and starts an &#123;@link HttpProxyServer&#125;.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function">HttpProxyServerBootstrap <span class="title">withFiltersSource</span><span class="params">(HttpFiltersSource filtersSource)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * HttpFiltersSource.java</span></div><div class="line"><span class="comment"> * interface HttpFiltersSource</span></div><div class="line"><span class="comment"> * Factory for &#123;@link HttpFilters&#125;.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"> <span class="function">HttpFilters <span class="title">filterRequest</span><span class="params">(HttpRequest originalRequest, ChannelHandlerContext ctx)</span></span>;</div><div class="line"> <span class="comment">/*</span></div><div class="line"><span class="comment">  * If the request/response size exceeds the maximum buffer size,</span></div><div class="line"><span class="comment">  * the request/response will fail, and</span></div><div class="line"><span class="comment">  * the proxy will stop processing the request/respond with a 502 Bad Gateway error.</span></div><div class="line"><span class="comment">  */</span></div><div class="line"> <span class="function"><span class="keyword">int</span> <span class="title">getMaximumRequestBufferSizeInBytes</span><span class="params">()</span></span>;</div><div class="line"> <span class="function"><span class="keyword">int</span> <span class="title">getMaximumResponseBufferSizeInBytes</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"> <span class="comment">/*</span></div><div class="line"><span class="comment">  * HttpFilters.java</span></div><div class="line"><span class="comment">  * interface HttpFilters</span></div><div class="line"><span class="comment">  *</span></div><div class="line"><span class="comment">  * Multiple methods are defined, corresponding to different steps in the request processing lifecycle.</span></div><div class="line"><span class="comment">  * Because HTTP transfers can be chunked, for any given request or response, the filter methods (that can modify request/response in place) may be called multiple times:</span></div><div class="line"><span class="comment">  * 1. once for the initial &#123;@link HttpRequest&#125; or &#123;@link HttpResponse&#125;</span></div><div class="line"><span class="comment">  * 2. once for each subsequent &#123;@link HttpContent&#125;</span></div><div class="line"><span class="comment">  * 3. the last chunk will always be a &#123;@link LastHttpContent&#125; and can be checked for being last using &#123;@link ProxyUtils#isLastChunk(HttpObject)&#125;.</span></div><div class="line"><span class="comment">  */</span></div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HttpFilters</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>
<h3 id="HttpFilters"><a href="#HttpFilters" class="headerlink" title="HttpFilters"></a>HttpFilters</h3><p>由此引入我们第一个介绍的接口<code>HttpFilters</code>，一般在<code>HttpFiltersSource#filterRequest</code>中使用。<code>HttpFilters</code>接口定义了如下方法，在使用时会按照先后顺序被调用：</p>
<ol>
<li>clientToProxyRequest</li>
<li>proxyToServerConnectionQueued</li>
<li>proxyToServerResolutionStarted</li>
<li>proxyToServerResolutionSucceeded</li>
<li>proxyToServerRequest (can be multiple if chunked)</li>
<li>proxyToServerConnectionStarted</li>
<li>proxyToServerConnectionFailed (if connection couldn’t be established)</li>
<li>proxyToServerConnectionSSLHandshakeStarted (only if HTTPS required)</li>
<li>proxyToServerConnectionSucceeded</li>
<li>proxyToServerRequestSending</li>
<li>proxyToServerRequestSent</li>
<li>serverToProxyResponseReceiving</li>
<li>serverToProxyResponse (can be multiple if chunked)</li>
<li>serverToProxyResponseReceived</li>
<li>proxyToClientResponse</li>
</ol>
<p>以下是一个通过代理请求打印信息的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Slf</span>4j</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomHttpFiltersSource</span> <span class="keyword">extends</span> <span class="title">HttpFiltersSourceAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> HttpFilters <span class="title">filterRequest</span><span class="params">(HttpRequest originalRequest, ChannelHandlerContext ctx)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> UserDefinedHttpFilters(originalRequest, ctx);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDefinedHttpFilters</span> <span class="keyword">extends</span> <span class="title">HttpFiltersAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    UserDefinedHttpFilters(HttpRequest originalRequest,</div><div class="line">        ChannelHandlerContext ctx) &#123;</div><div class="line">      <span class="keyword">super</span>(originalRequest, ctx);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> HttpResponse <span class="title">clientToProxyRequest</span><span class="params">(HttpObject httpObject)</span> </span>&#123;</div><div class="line">      printInfo(<span class="string">"clientToProxyRequest"</span>, httpObject);</div><div class="line">      <span class="keyword">return</span> <span class="keyword">super</span>.clientToProxyRequest(httpObject);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> HttpResponse <span class="title">proxyToServerRequest</span><span class="params">(HttpObject httpObject)</span> </span>&#123;</div><div class="line">      printInfo(<span class="string">"proxyToServerRequest"</span>, httpObject);</div><div class="line">      <span class="keyword">return</span> <span class="keyword">super</span>.proxyToServerRequest(httpObject);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printInfo</span><span class="params">(String methodName, HttpObject httpObject)</span> </span>&#123;</div><div class="line">      log.info(<span class="string">"[&#123;&#125;]\t&#123;&#125;\t[[is last=&#123;&#125;]]"</span>, methodName, httpObject, ProxyUtils.isLastChunk(httpObject));</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ChainedProxy"><a href="#ChainedProxy" class="headerlink" title="ChainedProxy"></a>ChainedProxy</h3><p>接口<code>ChainedProxy</code>在且仅在<code>ChainedProxyManager#lookupChainedProxies</code>中使用，<code>ChainedProxyManager</code>也是一个接口，提供<code>lookupChainedProxies</code>方法。一般情况下可以通过继承<code>ChainedProxyAdapter</code>的方式使用，不需要直接实现<code>ChainedProxy</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Interface for classes that manage chained proxies.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ChainedProxyManager</span> </span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * 1. Based on the given httpRequest, add any &#123;<span class="doctag">@link</span> ChainedProxy&#125;s to the list that should be used to process the request. The downstream proxy will attempt to connect to each of these in the order that they appear until it successfully connects to one.</span></div><div class="line"><span class="comment">   * 2. To allow the proxy to fall back to a direct connection, you can add &#123;<span class="doctag">@link</span> ChainedProxyAdapter#FALLBACK_TO_DIRECT_CONNECTION&#125; to the end of the list.</span></div><div class="line"><span class="comment">   * 3. To keep the proxy from attempting any connection, leave the list blank. This will cause the proxy to return a 502 response.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">lookupChainedProxies</span><span class="params">(HttpRequest httpRequest, Queue&lt;ChainedProxy&gt; chainedProxies)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ActivityTracker"><a href="#ActivityTracker" class="headerlink" title="ActivityTracker"></a>ActivityTracker</h3><blockquote>
<p>Interface for receiving information about activity in the proxy.</p>
</blockquote>
<h3 id="FlowContext-amp-FullFlowContext"><a href="#FlowContext-amp-FullFlowContext" class="headerlink" title="FlowContext &amp; FullFlowContext"></a>FlowContext &amp; FullFlowContext</h3><blockquote>
<p>Encapsulates contextual information for flow information that’s being reported to a {@link ActivityTracker}.</p>
<p>Extension of {@link FlowContext} that provides additional information (which we know after actually processing the request from the client).</p>
</blockquote>
<h3 id="ProxyAuthenticator"><a href="#ProxyAuthenticator" class="headerlink" title="ProxyAuthenticator"></a>ProxyAuthenticator</h3><blockquote>
<p>Interface for objects that can authenticate someone for using our Proxy on the basis of a username and password.</p>
</blockquote>
<h2 id="The-code"><a href="#The-code" class="headerlink" title="The code"></a>The code</h2><p>以下是一个完整的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Slf</span>4j</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomChainedProxyManager</span> <span class="keyword">implements</span> <span class="title">ChainedProxyManager</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lookupChainedProxies</span><span class="params">(HttpRequest httpRequest, Queue&lt;ChainedProxy&gt; chainedProxies)</span> </span>&#123;</div><div class="line">    log.info(<span class="string">"[lookupChainedProxies] &#123;&#125;"</span>, httpRequest);</div><div class="line">    chainedProxies.add(ChainedProxyAdapter.FALLBACK_TO_DIRECT_CONNECTION);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Slf</span>4j</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomActivityTracker</span> <span class="keyword">extends</span> <span class="title">ActivityTrackerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bytesSentToServer</span><span class="params">(FullFlowContext flowContext, <span class="keyword">int</span> numberOfBytes)</span> </span>&#123;</div><div class="line">    log.info(<span class="string">"[bytesSentToServer] (&#123;&#125; bytes) with &#123;&#125;"</span>, numberOfBytes, flowContext.getChainedProxy());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestSentToServer</span><span class="params">(FullFlowContext flowContext, HttpRequest httpRequest)</span> </span>&#123;</div><div class="line">    log.info(<span class="string">"[requestSentToServer] (&#123;&#125;) with &#123;&#125;"</span>, httpRequest, flowContext.getServerHostAndPort());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bytesReceivedFromServer</span><span class="params">(FullFlowContext flowContext, <span class="keyword">int</span> numberOfBytes)</span> </span>&#123;</div><div class="line">    log.info(<span class="string">"[bytesReceivedFromServer] (&#123;&#125; bytes) with &#123;&#125;"</span>, numberOfBytes, flowContext.getChainedProxy());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">responseReceivedFromServer</span><span class="params">(FullFlowContext flowContext, HttpResponse httpResponse)</span> </span>&#123;</div><div class="line">    log.info(<span class="string">"[responseReceivedFromServer] (&#123;&#125;) with &#123;&#125;"</span>, httpResponse, flowContext.getChainedProxy());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clientConnected</span><span class="params">(InetSocketAddress clientAddress)</span> </span>&#123;</div><div class="line">    log.info(<span class="string">"[clientConnected] &#123;&#125;"</span>, clientAddress.getAddress());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clientDisconnected</span><span class="params">(InetSocketAddress clientAddress, SSLSession sslSession)</span> </span>&#123;</div><div class="line">    log.info(<span class="string">"[clientDisconnected] &#123;&#125;"</span>, clientAddress.getAddress());</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Slf</span>4j</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomProxyAuthenticator</span> <span class="keyword">implements</span> <span class="title">ProxyAuthenticator</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">authenticate</span><span class="params">(String userName, String password)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"wang"</span>.equals(userName) &amp;&amp; <span class="string">"feng"</span>.equals(password);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getRealm</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">HttpProxyServer server = DefaultHttpProxyServer.bootstrap()</div><div class="line">        .withAddress(<span class="keyword">new</span> InetSocketAddress(properties.getHost(), properties.getPort()))</div><div class="line">        .withConnectTimeout(properties.getConnectTimeout())</div><div class="line">        .withIdleConnectionTimeout(properties.getIdleConnectionTimeout())</div><div class="line">        .withThreadPoolConfiguration(<span class="keyword">new</span> ThreadPoolConfiguration()</div><div class="line">            .withAcceptorThreads(properties.getAcceptThreadNumber())</div><div class="line">            .withClientToProxyWorkerThreads(properties.getClient2proxyThreadNumber())</div><div class="line">            .withProxyToServerWorkerThreads(properties.getProxy2serverThreadNumber()))</div><div class="line">        .withProxyAuthenticator(proxyAuthenticator)</div><div class="line">        .withFiltersSource(httpFiltersSource)</div><div class="line">        .withChainProxyManager(chainedProxyManager)</div><div class="line">        .plusActivityTracker(activityTracker)</div><div class="line">        .start();</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://thedatasolutions.com/2017/04/29/TCP-IP-Illustrated-Vol-1-3-Ping-and-Traceroute/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="逢哥">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员的自我修养">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/29/TCP-IP-Illustrated-Vol-1-3-Ping-and-Traceroute/" itemprop="url">
                  TCP/IP Illustrated Vol.1 (3) -- Ping and Traceroute
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-29T08:34:37+08:00">
                2017-04-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Ping"><a href="#Ping" class="headerlink" title="Ping"></a>Ping</h3><blockquote>
<p>The ping program sends an ICMP echo request to a host, expecting an ICMP echo reply to be returned.<br>Normally if you can’t Ping a host, you won’t be able to Telnet or FTP to that host. Conversely, if you can’t Telnet to a host, Ping is often the starting point to determine what the problem is.<br>Ping also measures the round-trip time to the host, give us some indication of how “far away” that host is.</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://thedatasolutions.com/2017/04/19/TCP-IP-Illustrated-Vol-1-2-IP-Internet-Protocol/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="逢哥">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员的自我修养">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/19/TCP-IP-Illustrated-Vol-1-2-IP-Internet-Protocol/" itemprop="url">
                  TCP/IP Illustrated Vol.1 (2) -- IP: Internet Protocol
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-19T23:38:52+08:00">
                2017-04-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>IP is the workhorse protocol of the TCP/IP protocol suite. All TCP, UDP, ICMP, and IGMP data gets transmitted as IP datagrams. A fact that amazes many newcomers to TCP/IP is that IP provides an unreliable, connectionless datagram delivery service.</p>
<ul>
<li>By <strong>unreliable</strong> we mean there are no guarantees that an IP datagram successfully gets to its destination. IP provides a best effort service. When something goes wrong, …, IP has a simple error handling algorithm: throw away the datagram and try to send an ICMP message back to the source. Any required reliability must be provided by the upper layers (e.g., TCP).</li>
<li>The term <strong>connectionless</strong> means that IP does not maintain any state information about successive datagrams. Each datagram is handled independently from all other datagrams. This also means that IP datagrams can get delivered out of order.</li>
</ul>
</blockquote>
<h3 id="IP-header"><a href="#IP-header" class="headerlink" title="IP header"></a>IP header</h3><p><img src="/img/IP-Header.png" alt="IP Header"></p>
<ul>
<li><code>4-bit version</code> (0-15).<ul>
<li>当前版本是4，因此IP有时又称为IPv4。</li>
</ul>
</li>
<li><code>4-bit header length</code> (0-15), the number of 32-bit words in the header.<ul>
<li>每32位字长记为1，<code>IP header</code>最小长度为20字节，因此<code>header length</code>字段最小为5；<code>header length</code>最大为15，因此<code>IP header</code>最长为60字节。</li>
</ul>
</li>
<li><code>8-bit type of service (TOS)</code>, is composed 3-bit precedence field (which is ignored today), 4 TOS bits, and an unused bit that must be 0.<ul>
<li>所以只需要关心其中4位即可，和tcpdump的输出有关。</li>
</ul>
</li>
<li><code>16-bit total length (in bytes)</code> (0-65535).</li>
<li><code>16-bit identification</code> (0-65535), uniquely identifies each datagram sent by a host. It normally increments by 1 each time a datagram is sent.</li>
<li><code>8-bit time-to-live (TTL)</code> (0-255), an upper limit on the number of routers through which a datagram can pass. It is initialized by the sender (often 32 or 64) and decremented by 1 by every router that handles the datagram. When this field reaches 0, the datagram is thrown away, and the sender is notified with an ICMP message.<ul>
<li>traceroute</li>
</ul>
</li>
<li><code>8-bit protocol</code> (0-255), identifies which protocol gave the data for IP to send.</li>
<li><p><code>16-bit header checksum</code>, is calculated over the IP header only. It does not cover any data follows the header.</p>
<blockquote>
<p>To compute the checksum for an outgoing datagram, the value of the checksum field is first set to 0. Then the 16-bit one’s complement sum of the header is calculated (i.e., the entire header is considered a sequence of 16-bit words). The 16-bit one’s complement of this sum is stored in the checksum field.</p>
</blockquote>
<p><code>IP header</code>看做16位字长的序列，checksum算法就是将所有16位字的序列以补码形式相加，然后再对相加和取补。</p>
<blockquote>
<p>When an IP datagram is received, the 16-bit one’s complement sum of the header is calculated. Since the receiver’s calculated checksum contains the checksum stored by the sender, the receiver’s checksum is all 1 bits if nothing in header was modified. If not (a checksum error), IP discards the received datagram. No error message is generated. It is up to higher layers to somehow detect the missing datagram and retransmit.</p>
</blockquote>
<p>由于接收方计算的checksum包含了sender发送的checksum，<del>根据某种数学原理</del>，接收方计算的checksum应该全为1，否则就是出错了。如果出错，IP抛弃收到的数据报，而非生成一个错误消息，由上层发现丢失数据报并重传。</p>
</li>
<li><code>32-bit source address</code> and <code>32-bit destination address</code></li>
</ul>
<h3 id="IP-routing"><a href="#IP-routing" class="headerlink" title="IP routing"></a>IP routing</h3><p>IP层既可以配置成路由器，也可以配置成主机。他两个的本质区别是路由器转发数据报，而主机不转发（除非被特殊设置）。</p>
<blockquote>
<p>IP layer can be configured to act as a router in addition to acting as a host. The fundamental difference is that a host <strong>never</strong> forwards datagrams from one of its interfaces to another, while a router forwards datagrams. A host that contains embedded router functionality should never forward a datagram unless it has been specifically configured to do so.</p>
</blockquote>
<p>IP层接收并发送的数据有两种：一种是本地生成的数据报，另一种是从网络接口中接收待转发的数据报。</p>
<blockquote>
<p>IP can receive a datagram from TCP, UDP, ICMP, or IGMP (that is, a locally generated datagram) to send, or one that has been received from a network interface (a datagram to forward).</p>
</blockquote>
<p>IP层在内存中有一个路由表，每次接收到数据报都要搜索这个路由表。当IP层接收来自网络接口的数据报，首先要检查（数据报的）目的IP地址是否本机的IP地址之一，或者是否是IP广播地址：如果是、这个数据报会被送到IP header中protocol字段所指定的协议模块进行处理，如果不是、(1)如果IP层被设置为路由，则进行转发；(2)否则（如果是主机）则数据报被抛弃。</p>
<blockquote>
<p>The IP layer has a routing table in memory that it searches each time it receives a datagram to send. When a datagram is received from a network interface, IP first checks if the destination IP address is one of its own IP addresses or an IP broadcase address. If so, the datagram is delivered to the protocol module specified by the protocol field in the IP header. If the datagram is not destined for this IP layer, the (1) if the IP layer was configured to act as a router the packet is forwarded, else (2) the datagram is silently discarded.</p>
</blockquote>
<p>路由表中的每一项都包含：</p>
<ol>
<li>目的IP地址</li>
<li>下一站路由的IP地址</li>
<li>标志（网络地址or主机地址，下一站路由是真的下一站路由or直连接口）</li>
<li>为数据报的传输指定一个网络接口</li>
</ol>
<p>IP路由选择主要是搜索路由表：</p>
<ol>
<li>寻找与目的IP地址匹配的表目</li>
<li>寻找与目的网络号相匹配的表目</li>
<li>寻找默认表目</li>
</ol>
<p>如果以上3个都没有成功，则该数据报不能被传送，同时如果该数据报来自本地，那么一般会向生成数据报的应用程序返回一个“主机不可达”或“网络不可达”的错误。</p>
<p>IP路由选择机制的另一个基本特性是：为一个网络指定一个路由，而不必为每个主机指定一个路由。这样可以极大地缩小路由表的规模</p>
<blockquote>
<p>The ability to specify a route to a network, and not have to specify a route to every host, is another fundamental feature of IP routing. Doing this allows the routers on the Internet, for example, to have a routing table with thousands of entries, instead of a routing table with millions of entries.</p>
</blockquote>
<h3 id="Subnet-Addressing"><a href="#Subnet-Addressing" class="headerlink" title="Subnet Addressing"></a>Subnet Addressing</h3><p>上面说的<strong>为一个网络指定一个路由</strong>，我的理解这一个个的网络就是子网。如果把IP简单划分为网络号和主机号，A类网络（2<sup>24</sup>-2）和B类网络（2<sup>16</sup>-2）就拥有了太多的主机。这样IP层的路由表就会非常的大。</p>
<p>拿B类网络来说，一般默认情况是把16位主机号一分为二，前8位用于子网号，后8位用作主机号。这样一来，所有以140.252开头的B类IP地址，只需要一个路由表目。</p>
<p>子网对外部路由隐藏了内部的网络结构。换种说法，这一台外部路由负责了内部所有子网和主机的Internet接入。比如一个<code>IP目的地址</code>为<code>140.252.57.1</code>的数据报，先到达<code>140.252.104.1</code>的<code>gateway</code>（外部网关），这个<code>路由网关</code>需要知道<code>子网号</code>是57的路由表目，中间可能不能直达57号子网，需要通过55号子网作为中转而后“跳”到57号子网。</p>
<h3 id="Subnet-Mask"><a href="#Subnet-Mask" class="headerlink" title="Subnet Mask"></a>Subnet Mask</h3><p>子网掩码是一个32位长度的地址，它的作用结合IP地址，将IP地址划分为网络地址和主机地址。</p>
<p>子网掩码标记为1的留给网络号和子网号，标记为0的留给主机号。</p>
<h3 id="ipconfg"><a href="#ipconfg" class="headerlink" title="ipconfg"></a>ipconfg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ifconfig -a</div></pre></td></tr></table></figure>
<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netstat -<span class="keyword">in</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://thedatasolutions.com/2017/04/18/TCP-IP-Illustrated-Vol-1-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="逢哥">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员的自我修养">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/18/TCP-IP-Illustrated-Vol-1-1/" itemprop="url">
                  TCP/IP Illustrated Vol.1 (1)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-18T22:08:43+08:00">
                2017-04-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近开始做二级代理的相关工作，发现自己对<code>TCP/IP</code>这个协议知之甚少，很多地方模棱两可。正视自己的不足，开始学习《TCP/IP协议详解 卷一：协议》。</p>
<h3 id="4层协议"><a href="#4层协议" class="headerlink" title="4层协议"></a>4层协议</h3><h4 id="分层"><a href="#分层" class="headerlink" title="分层"></a>分层</h4><table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">应用层</td>
<td style="text-align:center">Application</td>
<td style="text-align:center">handles the details of particular application</td>
<td style="text-align:center">Telnet, FTP, SMTP, etc</td>
</tr>
<tr>
<td style="text-align:center">运输层</td>
<td style="text-align:center">Transport</td>
<td style="text-align:center">provides a flow of data between two computers</td>
<td style="text-align:center">TCP, UDP</td>
</tr>
<tr>
<td style="text-align:center">网络层</td>
<td style="text-align:center">Network</td>
<td style="text-align:center">handles the movement of packets</td>
<td style="text-align:center">IP, ICMP, IGMP</td>
</tr>
<tr>
<td style="text-align:center">链路层</td>
<td style="text-align:center">Link</td>
<td style="text-align:center">handles hardware details of physically interfacing</td>
<td style="text-align:center">device driver and interface card</td>
</tr>
</tbody>
</table>
<h4 id="TCP-IP层"><a href="#TCP-IP层" class="headerlink" title="TCP/IP层"></a>TCP/IP层</h4><p>网络层<code>IP</code>提供了一个不可靠的服务，在不保证可靠性的情况下尽可能快地把包<code>packet</code>从源点移动到终点。</p>
<blockquote>
<p>In the TCP/IP protocol suite the network layer, IP, provides an unreliable service. That is, it does its best job of moving a packet from its source to its final destination, but there are no guarantees.</p>
</blockquote>
<p><code>TCP</code>在不可靠的IP层上提供一个可靠的服务，为了提供这种可靠的服务，TCP采用了超时重传、发送/接受端到端的确认等（机制）。</p>
<blockquote>
<p>TCP provides a reliable transport layer, even though the service it uses (IP) is unreliable.<br>To provide this service, TCP performs timeout and retransmission, sends and receives end-to-end acknowledgments, and so on.</p>
</blockquote>
<p><code>UDP</code>发送和接受<code>数据报</code>（一个信息单元从发送方传输到接收方）。UDP是不可靠的，不能保证数据报最终到达它的目的地。</p>
<blockquote>
<p>UDP sends and receives datagrams for applications. A datagram is a unit of information that travels from the sender to the receiver. Unlike TCP, however, UDP is unreliable. There is no guarantee that the datagram ever gets to its final destination.</p>
</blockquote>
<p><code>IP</code>是网络层上的主要协议。TCP和UDP都使用IP，很少有应用程序直接使用IP。<code>ICMP</code>是<code>IP</code>的附属协议，我们常用的<code>ping</code>和<code>traceroute</code>就是使用了ICMP。<code>IGMP</code>(Internet Group Management Protocol)用于多播：把UDP数据报发送给多个主机。</p>
<p><code>ARP</code>(Address Resolution Protocol)和<code>RARP</code>(Reverse ARP)用于网络层和链路层之间，针对某些特定的网络接口，用来转换IP地址和网络接口地址。</p>
<h4 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h4><blockquote>
<p>Every interface on an internet must have a unique Internet address (also called an IP address)</p>
</blockquote>
<p>IP地址长度为32位（32bits），也就是4字节（4bytes）。每个字节用一个十进制整数来表示，这就是“Dotted decimal notation”。IP地址分为5类，ABCDE，区分方法体现在高位上第一个字节位：以二进制表示，0开头的是A类，10开头的是B类，110是C类，1110是D类，1111是E类。</p>
<h4 id="Encapsulation-封装"><a href="#Encapsulation-封装" class="headerlink" title="Encapsulation 封装"></a>Encapsulation 封装</h4><p>数据在发送过程中自顶向下经过每层协议栈，都会附加一些信息，名字也会有变化。<br>TCP发送给IP的数据单元叫<code>TCP段</code>，IP发送给网络接口的数据单元叫<code>IP数据报</code> ，通过以太网传输的比特流叫做<code>帧</code>。</p>
<blockquote>
<p>When an application sends data using TCP, the data is sent down the protocol stack, through each layer, until it is sent as a stream of bits across the network. Each Layer adds information to the data by prepending headers (and sometimes add tailer information) to the data that it receives.</p>
<ul>
<li>The unit of data that TCP sends to IP is called a <code>TCP segment</code>.</li>
<li>The unit of data that IP sends to the network interface is called an <code>IP datagram</code>. (To be completely accurate, called a <code>packet</code> that can either be an <code>IP datagram</code> or <code>a fragment of an IP datagram</code>)</li>
<li>The stream of bits that flows acorss the Ethernet is called a <code>frame</code>.</li>
<li>The only differences between TCP and UDP are that the unit of data that UDP passes to IP is called a <code>UDP datagram</code>, and the size of UDP header is less (UDP header is 8 bytes whereas TCP header is 20 bytes).</li>
</ul>
</blockquote>
<h4 id="端口号"><a href="#端口号" class="headerlink" title="端口号"></a>端口号</h4><blockquote>
<p>TCP and UDP identify applications using 16-bit port numbers.</p>
</blockquote>
<p>Math.pow(2, 16) - 1 等于65535。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="逢哥" />
          <p class="site-author-name" itemprop="name">逢哥</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">逢哥</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
